{% extends "base.html" %}
{% block title %}Dashboard{% endblock %}
{% block header %}Dashboard{% endblock %}
{% block content %}
	<section class="decisions">
		<h2 class="widgetHeader">My Decisions</h2>
	{% for invite in user.getDecisionsInvited %}
		<div class="itemWrapper">
			<i class="fa fa-plus" onclick="openContent(this);"></i>
			<a href="{% url 'decision_detail' invite.decision.id %}">
				<h2>{{ invite.decision.name }}</h2>
				<span>{{ invite.decision.getCompleteness }}</span>
			</a>
			<div class="collapsedContent">collapsed</div>
		</div>
	{% endfor %}
	{% for decision in user.getDecisionsCreated %}
		<div class="itemWrapper">
			<i class="fa fa-plus" onclick="openContent(this);"></i>
			<a href="{% url 'decision_detail' decision.id %}">
				<h2>{{ decision.name }}</h2>
				<span>{{ decision.getCompleteness }}</span>
			</a>
			<div class="collapsedContent">collapsed</div>
		</div>
	{% endfor %}
	</section>
	{% with invites=object.getUnrespondedInvites %}
	{% if invites %}
	<section class="invites">
		<h2 class="widgetHeader">Invites</h2>
		{% for item in invites %}
			<div class="itemWrapper">
				<i class="fa fa-plus" onclick="openContent(this);"></i>
				<a href="{% url 'decision_detail' item.decision.id %}"><h2>{{ item.decision.name }}</h2></a>
				Stav: {{ item.get_state_display }}
				<a class="button tiny success" href="javascript:acceptInvite(event, {{ item.id }})"><i class="fa fa-check"></i></a>
				<a class="button tiny alert" href="javascript:removeInvite(event, {{ item.id }})"><i class="fa fa-times"></i></a>
				<div class="collapsedContent">collapsed</div>
			</div>
		{% endfor %}
	</section>
	{% endif %}
	{% endwith %}
{% endblock %}
{% block javascript %}
<script>
	function acceptInvite(event, inviteId){
		$.post(
			"{% url 'invite_accept' %}",
			{ 
				inviteId: inviteId, 
				csrfmiddlewaretoken: '{{ csrf_token }}' 
			},
			function(data){
				handleData(data);
			}
		);
	}
	function removeInvite(event, inviteId){
		$.post(
			"{% url 'invite_remove' %}",
			{ 
				inviteId: inviteId, 
				csrfmiddlewaretoken: '{{ csrf_token }}' 
			},
			function(data){
				handleData(data);
			}
		);
	}	
	
</script>
{% endblock %}
